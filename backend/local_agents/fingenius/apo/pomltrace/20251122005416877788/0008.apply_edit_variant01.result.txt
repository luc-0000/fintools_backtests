===== system =====

Revise the given prompt template using the critique as constraints and improvement guide.

# Revision Rules

1. Rewrite or restructure the prompt if critique implies it.
2. Explicitly include any requested output format, structure, or word limit, if requested by the critique.
3. Prioritize mechanism-first phrasing: define what to do, then how to do it.
4. Preserve placeholder variables inside curly brackets.

# Output Format

Return only the improved prompt template with placeholders intact. Do not include other explanations on how you did it, or headers and introductory texts.

===== human =====

# Prompt Template

根据当前状态，判断哪些流程已经执行完毕，直接执行下一个流程。如果流程前面已经执行过，不要重复执行。

**工作流程规则**：
1. **数据收集阶段**：  
   - 允许使用 `数据收集工具`，**禁用其他所有工具**（包括 `terminate`）。  
   - 指令示例：  
     > "当前仅允许使用数据收集工具，禁止调用任何其他工具。输出格式：`[数据收集结果]`"

2. **深度分析阶段**：  
   - **禁用所有工具**（包括 `terminate`），仅允许生成分析文本。  
   - 指令示例：  
     > "当前处于深度分析阶段，禁止调用任何工具。请基于数据生成专业分析报告，不要解释思考过程。"

3. **综合结论阶段**：  
   - 允许调用 `terminate` 结束任务。  
   - 指令示例：  
     > "分析完成后，调用 `terminate` 工具提交最终结论。"
     
{{ if 输出包含 "terminate" 且 当前阶段 != "综合结论" }}  
  ❗ 违规操作！深度分析阶段禁止调用工具！请重新生成纯文本分析报告。  
{{ end }}

重要提示：如果状态中已经含有收集的数据，不要重复收集，进入下一个流程！



# Critique

**Critique of the Prompt**

**1. Structural Issues**  
- **Missing goal**: The prompt lacks a clear, one-line success definition (e.g., "Produce a final conclusion using data collection, analysis, and termination").  
- **No stop condition**: The only explicit stop is via `terminate`, but it’s unclear how the model knows when analysis is "complete" to proceed to the final stage.  
- **Circular dependency risk**: The model must infer stage transitions from "current state," but rules don’t define how to detect state changes (e.g., what signifies "data already collected"?).

**2. Instruction Quality**  
- **Vague verbs**: "判断哪些流程已经执行完毕" ("judge which processes are complete") is ambiguous—no criteria are given for determining completion.  
- **Mixed abstraction**: High-level rules (e.g., "do not repeat executed processes") are mixed with low-level tool restrictions, creating confusion.  
- **Overlapping scope**: The "important tip" about not repeating data collection duplicates the opening instruction but adds no new clarity.

**3. Control and Behavior**  
- **Unclear uncertainty handling**: No guidance on what to do if the "current state" is missing or ambiguous.  
- **Verbosity confusion**: The analysis stage says "不要解释思考过程" ("do not explain thinking process"), but other stages lack style guidance.  
- **No feedback mechanism**: The model isn’t instructed to report stage transitions or confirm assumptions about state.

**4. Input and Output Specification**  
- **No input defaults**: The prompt assumes "current state" will always clearly indicate stage and data, but no fallback is provided for invalid/missing states.  
- **Format inconsistency**: Output format is only specified for the data collection stage (`[数据收集结果]`); other stages have no format rules.  
- **No validation**: Missing a step to verify data quality or analysis completeness before calling `terminate`.

**5. Scope and Safety**  
- **Scope creep**: The conditional check (`{{ if ... }}`) implies runtime enforcement, but it’s written as a comment—actual enforcement is unclear.  
- **User authority ambiguity**: The model autonomously decides stage transitions based on state, which could lead to incorrect jumps if state is misread.

**6. Efficiency and Maintainability**  
- **Redundancy**: Multiple reminders not to repeat processes (opening line, "important tip").  
- **Hidden assumptions**: Assumes the model can accurately track "executed processes" without a defined state structure.

**Summary**: The prompt has logical gaps in state management, undefined completion criteria, and inconsistent output formatting. It risks tool misuse or premature termination due to ambiguous transition rules.