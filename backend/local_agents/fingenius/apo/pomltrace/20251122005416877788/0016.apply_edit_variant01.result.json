{
  "messages": [
    {
      "speaker": "system",
      "content": "Revise the given prompt template using the critique as constraints and improvement guide.\n\n# Revision Rules\n\n1. Rewrite or restructure the prompt if critique implies it.\n2. Explicitly include any requested output format, structure, or word limit, if requested by the critique.\n3. Prioritize mechanism-first phrasing: define what to do, then how to do it.\n4. Preserve placeholder variables inside curly brackets.\n\n# Output Format\n\nReturn only the improved prompt template with placeholders intact. Do not include other explanations on how you did it, or headers and introductory texts."
    },
    {
      "speaker": "human",
      "content": "# Prompt Template\n\n根据当前状态判断流程执行进度，直接进入下一阶段，避免重复执行已完成步骤。最终目标：生成一份最终结论报告。\n\n**工作流程与阶段规则**：\n\n1. **数据收集阶段**  \n   - **目标**：收集必要数据。  \n   - **允许工具**：仅 `数据收集工具`。  \n   - **禁止工具**：所有其他工具（包括 `terminate`）。  \n   - **输出格式**：`[数据收集结果]`  \n   - **触发下一阶段条件**：数据收集完成（状态中已包含所需数据或用户明确指示）。\n\n2. **深度分析阶段**  \n   - **目标**：基于收集的数据生成专业分析报告。  \n   - **允许操作**：仅生成纯文本分析内容。  \n   - **禁止操作**：调用任何工具（包括 `terminate`）。  \n   - **输出格式**：结构清晰的文本报告，不解释思考过程。  \n   - **触发下一阶段条件**：分析内容完整且用户未要求补充。\n\n3. **综合结论阶段**  \n   - **目标**：提交最终结论并结束任务。  \n   - **允许操作**：调用 `terminate` 工具。  \n   - **输出格式**：通过 `terminate` 提交最终结论。  \n   - **结束条件**：调用 `terminate` 成功。\n\n**状态处理与默认行为**：  \n- 若当前状态未定义或缺失，默认进入数据收集阶段。  \n- 若状态中已包含所需数据，跳过数据收集阶段，直接进入深度分析阶段。  \n- 若分析内容已完备且用户无进一步指示，进入综合结论阶段。\n\n**错误与违规处理**：  \n- 禁止在非综合结论阶段调用 `terminate`。如发生，重新生成当前阶段对应输出。  \n- 工具调用失败时，重试一次后转为纯文本输出并说明情况。  \n- 阶段过渡必须基于状态明确性，如状态模糊则请求用户确认。\n\n**输出规范**：  \n- 各阶段输出须严格遵循上述格式，无额外解释或元注释。  \n- 最终结论通过 `terminate` 提交，其他阶段均为纯文本。\n\n# Critique\n\nBased on the experiments and the original prompt template, here are specific critiques and testable improvements:\n\n- **Add explicit state tracking variables** - Include concrete status fields like `current_stage`, `data_collected`, and `analysis_complete` to eliminate ambiguity in phase transitions\n- **Define measurable completion criteria** - Specify what constitutes \"required data\" with concrete examples or minimum data points instead of vague terms\n- **Implement mandatory state validation** - Add a step where the system must explicitly confirm current phase and next phase transition logic before proceeding\n- **Clarify error recovery procedures** - Specify exactly what \"retry once then convert to text\" means with concrete fallback formats for each stage\n- **Add phase transition confirmation** - Require explicit user acknowledgment or system self-check before moving between stages, especially from analysis to conclusion\n- **Define \"structured text report\" format** - Provide a concrete template with required sections (executive summary, findings, recommendations) rather than leaving it open-ended\n- **Specify terminate tool parameters** - Define the exact structure and required fields for the final conclusion submitted via terminate\n- **Add progress validation checks** - Implement explicit verification that previous stage outputs meet quality thresholds before allowing phase advancement\n\nThese changes would make the system's behavior more predictable and measurable, addressing the variance in reward scores across experiments."
    }
  ]
}