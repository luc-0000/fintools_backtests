{
  "messages": [
    {
      "speaker": "human",
      "content": "# Role\n\nYou are a prompt engineer.\n\n# Task\n\nAnalyze where the current prompt failed to elicit the right mechanism.\n\n# Current Prompt Template\n\n根据当前状态，判断哪些流程已经执行完毕，直接执行下一个流程。如果流程前面已经执行过，不要重复执行。\n\n**阶段检测逻辑**：  \n{{ if 状态包含 \"[DATA_COLLECTION_RESULT:\" }}当前阶段 = \"深度分析\"  \n{{ else if 状态包含 \"[ANALYSIS_REPORT:\" }}当前阶段 = \"综合结论\"  \n{{ else }}当前阶段 = \"数据收集\"  \n{{ end }}\n\n**工作流程规则**：  \n1. **数据收集阶段**：  \n   - 允许使用 `数据收集工具`，**禁用其他所有工具**（包括 `terminate`）。  \n   - 输出格式：`[DATA_COLLECTION_RESULT: {收集的数据}]`  \n   - {{ if 状态包含 \"[DATA_COLLECTION_RESULT:\" }}跳过数据收集，直接进入深度分析阶段{{ end }}\n\n2. **深度分析阶段**：  \n   - **禁用所有工具**（包括 `terminate`），仅允许生成分析文本。  \n   - 输出格式：`[ANALYSIS_REPORT: {分析内容}]`  \n   - {{ if 状态包含 \"[ANALYSIS_REPORT:\" }}跳过深度分析，直接进入综合结论阶段{{ end }}\n\n3. **综合结论阶段**：  \n   - 允许调用 `terminate` 结束任务。  \n   - 输出格式：调用 `terminate` 工具并提交 `[FINAL_CONCLUSION: {最终结论}]`\n\n**违规检查**：  \n{{ if 当前阶段 == \"数据收集\" and 输出包含工具调用 and 调用工具 != \"数据收集工具\" }}  \n❗ 数据收集阶段违规：检测到非数据收集工具调用。允许工具：数据收集工具。检测到工具：{违规工具名}  \n{{ else if 当前阶段 == \"深度分析\" and 输出包含工具调用 }}  \n❗ 深度分析阶段违规：禁止调用任何工具！请重新生成纯文本分析报告，格式为：[ANALYSIS_REPORT: {分析内容}]  \n{{ else if 当前阶段 == \"综合结论\" and 输出不包含 \"terminate\" }}  \n❗ 综合结论阶段违规：必须调用 terminate 工具提交最终结论，格式为：[FINAL_CONCLUSION: {最终结论}]  \n{{ end }}\n\n**流程约束**：  \n{{ if 前一阶段已完成 }}禁止返回前一阶段操作{{ end }}\n\n# Sample Runs with Current Prompt Template\n\nThe following are the OpenTelemetry spans collected from the sample runs with the current prompt template. They should contain both prompt, responses and rewards.\n\n## Sample Run #1 Diagnostics\n\n{\"rollout_id\":\"ro-99bbc6a8bb96\",\"attempt_id\":\"at-b288113a\",\"sequence_id\":1,\"trace_id\":\"83a000b3263ab5054385f395b67b758b\",\"span_id\":\"4b93484d6d8d2067\",\"parent_id\":\"3d26f7579c43d7a6\",\"name\":\"agentlightning.reward\",\"status\":{\"status_code\":\"UNSET\",\"description\":null},\"attributes\":{\"reward\":0.9236795049282837},\"events\":[],\"links\":[],\"start_time\":1763744845.386204,\"end_time\":1763744845.386207,\"context\":{\"trace_id\":\"83a000b3263ab5054385f395b67b758b\",\"span_id\":\"4b93484d6d8d2067\",\"is_remote\":false,\"trace_state\":{}},\"parent\":{\"trace_id\":\"83a000b3263ab5054385f395b67b758b\",\"span_id\":\"3d26f7579c43d7a6\",\"is_remote\":false,\"trace_state\":{}},\"resource\":{\"attributes\":{\"service.name\":\"agentops\",\"agentops.project.id\":\"dummy\",\"imported_libraries\":[\"logging\",\"multiprocessing\"]},\"schema_url\":\"\"},\"kind\":\"SpanKind.INTERNAL\",\"instrumentation_info\":\"InstrumentationInfo(agentlightning, , )\",\"instrumentation_scope\":\"InstrumentationScope(agentlightning, , , {})\",\"sampler\":\"<opentelemetry.sdk.trace.sampling.ParentBased object at 0x108237fd0>\",\"trace_config\":null,\"record_exception\":true,\"set_status_on_exception\":true,\"limits\":\"SpanLimits(max_span_attributes=128, max_events_attributes=128, max_link_attributes=128, max_attributes=128, max_events=128, max_links=128, max_attribute_length=None)\",\"lock\":\"<unlocked _thread.lock object at 0x13893a000>\"}\n\n## Sample Run #2 Diagnostics\n\n{\"rollout_id\":\"ro-a10597631188\",\"attempt_id\":\"at-6aad0e79\",\"sequence_id\":1,\"trace_id\":\"83a000b3263ab5054385f395b67b758b\",\"span_id\":\"1c165e7aa6a92489\",\"parent_id\":\"3d26f7579c43d7a6\",\"name\":\"agentlightning.reward\",\"status\":{\"status_code\":\"UNSET\",\"description\":null},\"attributes\":{\"reward\":0.30633878047112817},\"events\":[],\"links\":[],\"start_time\":1763744845.381368,\"end_time\":1763744845.381372,\"context\":{\"trace_id\":\"83a000b3263ab5054385f395b67b758b\",\"span_id\":\"1c165e7aa6a92489\",\"is_remote\":false,\"trace_state\":{}},\"parent\":{\"trace_id\":\"83a000b3263ab5054385f395b67b758b\",\"span_id\":\"3d26f7579c43d7a6\",\"is_remote\":false,\"trace_state\":{}},\"resource\":{\"attributes\":{\"service.name\":\"agentops\",\"agentops.project.id\":\"dummy\",\"imported_libraries\":[\"logging\",\"multiprocessing\"]},\"schema_url\":\"\"},\"kind\":\"SpanKind.INTERNAL\",\"instrumentation_info\":\"InstrumentationInfo(agentlightning, , )\",\"instrumentation_scope\":\"InstrumentationScope(agentlightning, , , {})\",\"sampler\":\"<opentelemetry.sdk.trace.sampling.ParentBased object at 0x108237fd0>\",\"trace_config\":null,\"record_exception\":true,\"set_status_on_exception\":true,\"limits\":\"SpanLimits(max_span_attributes=128, max_events_attributes=128, max_link_attributes=128, max_attributes=128, max_events=128, max_links=128, max_attribute_length=None)\",\"lock\":\"<unlocked _thread.lock object at 0x1389387c0>\"}\n\n## Sample Run #3 Diagnostics\n\n{\"rollout_id\":\"ro-ba0826ea65df\",\"attempt_id\":\"at-d9f31e4f\",\"sequence_id\":1,\"trace_id\":\"83a000b3263ab5054385f395b67b758b\",\"span_id\":\"6aaafa7edf5afa00\",\"parent_id\":\"3d26f7579c43d7a6\",\"name\":\"agentlightning.reward\",\"status\":{\"status_code\":\"UNSET\",\"description\":null},\"attributes\":{\"reward\":0.18256839567573147},\"events\":[],\"links\":[],\"start_time\":1763744845.367438,\"end_time\":1763744845.367447,\"context\":{\"trace_id\":\"83a000b3263ab5054385f395b67b758b\",\"span_id\":\"6aaafa7edf5afa00\",\"is_remote\":false,\"trace_state\":{}},\"parent\":{\"trace_id\":\"83a000b3263ab5054385f395b67b758b\",\"span_id\":\"3d26f7579c43d7a6\",\"is_remote\":false,\"trace_state\":{}},\"resource\":{\"attributes\":{\"service.name\":\"agentops\",\"agentops.project.id\":\"dummy\",\"imported_libraries\":[\"logging\",\"multiprocessing\"]},\"schema_url\":\"\"},\"kind\":\"SpanKind.INTERNAL\",\"instrumentation_info\":\"InstrumentationInfo(agentlightning, , )\",\"instrumentation_scope\":\"InstrumentationScope(agentlightning, , , {})\",\"sampler\":\"<opentelemetry.sdk.trace.sampling.ParentBased object at 0x108237fd0>\",\"trace_config\":null,\"record_exception\":true,\"set_status_on_exception\":true,\"limits\":\"SpanLimits(max_span_attributes=128, max_events_attributes=128, max_link_attributes=128, max_attributes=128, max_events=128, max_links=128, max_attribute_length=None)\",\"lock\":\"<unlocked _thread.lock object at 0x13893b880>\"}\n\n## Sample Run #4 Diagnostics\n\n{\"rollout_id\":\"ro-eb35add4527d\",\"attempt_id\":\"at-5988a132\",\"sequence_id\":1,\"trace_id\":\"83a000b3263ab5054385f395b67b758b\",\"span_id\":\"9d9a17165958b91b\",\"parent_id\":\"3d26f7579c43d7a6\",\"name\":\"agentlightning.reward\",\"status\":{\"status_code\":\"UNSET\",\"description\":null},\"attributes\":{\"reward\":0.8924990173057967},\"events\":[],\"links\":[],\"start_time\":1763744845.375194,\"end_time\":1763744845.375199,\"context\":{\"trace_id\":\"83a000b3263ab5054385f395b67b758b\",\"span_id\":\"9d9a17165958b91b\",\"is_remote\":false,\"trace_state\":{}},\"parent\":{\"trace_id\":\"83a000b3263ab5054385f395b67b758b\",\"span_id\":\"3d26f7579c43d7a6\",\"is_remote\":false,\"trace_state\":{}},\"resource\":{\"attributes\":{\"service.name\":\"agentops\",\"agentops.project.id\":\"dummy\",\"imported_libraries\":[\"logging\",\"multiprocessing\"]},\"schema_url\":\"\"},\"kind\":\"SpanKind.INTERNAL\",\"instrumentation_info\":\"InstrumentationInfo(agentlightning, , )\",\"instrumentation_scope\":\"InstrumentationScope(agentlightning, , , {})\",\"sampler\":\"<opentelemetry.sdk.trace.sampling.ParentBased object at 0x108237fd0>\",\"trace_config\":null,\"record_exception\":true,\"set_status_on_exception\":true,\"limits\":\"SpanLimits(max_span_attributes=128, max_events_attributes=128, max_link_attributes=128, max_attributes=128, max_events=128, max_links=128, max_attribute_length=None)\",\"lock\":\"<unlocked _thread.lock object at 0x13894e1c0>\"}\n\n# Output Format\n\nWrite 3-5 short bullets titled 'Critique:' focusing on missing constraints, ordering, or formatting."
    }
  ]
}