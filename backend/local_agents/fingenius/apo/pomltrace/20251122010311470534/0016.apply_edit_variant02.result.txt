===== system =====

Revise the prompt to address ONE critique point clearly and effectively. Preserve all variable names in curly-brackets.

Do not address more than one critique point. Focus on the single most critical issue.

Keep the new prompt close in tone, length, and structure to the original.

# Output Format

Return only the revised full prompt. Do not include explanations, comparisons, or other text.

===== human =====

### PROMPT

根据当前状态，判断哪些流程已经执行完毕，直接执行下一个流程。如果流程前面已经执行过，不要重复执行。

**阶段检测逻辑**：  
{{ if 状态包含 "[DATA_COLLECTION_RESULT:" }}当前阶段 = "深度分析"  
{{ else if 状态包含 "[ANALYSIS_REPORT:" }}当前阶段 = "综合结论"  
{{ else }}当前阶段 = "数据收集"  
{{ end }}

**工作流程规则**：  
1. **数据收集阶段**：  
   - 允许使用 `数据收集工具`，**禁用其他所有工具**（包括 `terminate`）。  
   - 输出格式：`[DATA_COLLECTION_RESULT: {收集的数据}]`  
   - {{ if 状态包含 "[DATA_COLLECTION_RESULT:" }}跳过数据收集，直接进入深度分析阶段{{ end }}

2. **深度分析阶段**：  
   - **禁用所有工具**（包括 `terminate`），仅允许生成分析文本。  
   - 输出格式：`[ANALYSIS_REPORT: {分析内容}]`  
   - {{ if 状态包含 "[ANALYSIS_REPORT:" }}跳过深度分析，直接进入综合结论阶段{{ end }}

3. **综合结论阶段**：  
   - 允许调用 `terminate` 结束任务。  
   - 输出格式：调用 `terminate` 工具并提交 `[FINAL_CONCLUSION: {最终结论}]`

**违规检查**：  
{{ if 当前阶段 == "数据收集" and 输出包含工具调用 and 调用工具 != "数据收集工具" }}  
❗ 数据收集阶段违规：检测到非数据收集工具调用。允许工具：数据收集工具。检测到工具：{违规工具名}  
{{ else if 当前阶段 == "深度分析" and 输出包含工具调用 }}  
❗ 深度分析阶段违规：禁止调用任何工具！请重新生成纯文本分析报告，格式为：[ANALYSIS_REPORT: {分析内容}]  
{{ else if 当前阶段 == "综合结论" and 输出不包含 "terminate" }}  
❗ 综合结论阶段违规：必须调用 terminate 工具提交最终结论，格式为：[FINAL_CONCLUSION: {最终结论}]  
{{ end }}

**流程约束**：  
{{ if 前一阶段已完成 }}禁止返回前一阶段操作{{ end }}

### CRITIQUE

**Critique:**

*   **Missing Explicit State Parsing:** The prompt tells the agent to check the state, but it does not explicitly instruct the agent to first read and parse the state variable to determine which markers (`[DATA_COLLECTION_RESULT:`, etc.) are present. This is a critical first step that is implied but not commanded.

*   **Ambiguous "Output Format" for Tool Stages:** The "output format" for the Data Collection stage (`[DATA_COLLECTION_RESULT: ...]`) is described alongside a tool call. This creates confusion about whether the agent should call the tool *and then* output the tag, or if the tool's result *is* the data for the tag. The relationship between tool execution and the required output tag is unclear.

*   **Vague "深度分析" (Deep Analysis) Instruction:** The prompt instructs the agent to "generate analysis text" but provides no guidance on *what* to analyze. It lacks a clear input, such as "Analyze the data collected in the previous stage," leaving the agent's objective in this phase undefined and open to interpretation.

*   **Inconsistent Phase Transition Logic:** The logic for skipping stages is embedded within the rules for each stage (e.g., "{{ if 状态包含 "[DATA_COLLECTION_RESULT:" }}跳过数据收集..."). This structure can lead the agent to believe it must first consider executing a stage before checking if it should be skipped, rather than making a single, definitive determination of the current phase at the start of its reasoning.